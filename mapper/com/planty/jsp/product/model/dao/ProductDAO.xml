<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductDAO">
	
	<resultMap type="com.planty.jsp.board.model.dao.ProductDAO" id="selectAllProductList">
		<id property="no" column="BOARD_NO"/>
		<result property="type" column="BOARD_TYPE"/>
		<result property="categoryCode" column="CATEGORY_CODE"/>
		<result property="title" column="BOARD_TITLE"/>
		<result property="body" column="BOARD_BODY"/>
		<result property="writerMemberNo" column="BOARD_WRITER_MEMBER_NO"/>
		<result property="count" column="BOARD_COUNT"/>
		<result property="createdDate" column="CREATED_DATE"/>
		<result property="modifiedDate" column="MODIFIED_DATE"/>
		<result property="status" column="BOARD_STATUS"/>
		
		<association property="writer" resultMap="memberResultMap"/>
		<association property="category" resultMap="categoryResultMap"/>
	</resultMap>

	
	<select id="selectBoardList" resultMap="generalBoardResultMap">
         SELECT /* com.greedy.jsp.board.model.dao.BoardDAO#selectBoardList() */
               A.RNUM
             , A.BOARD_NO
             , A.BOARD_TYPE
             , A.CATEGORY_CODE
             , D.CATEGORY_NAME
             , A.BOARD_TITLE
             , A.BOARD_BODY
             , A.BOARD_WRITER_MEMBER_NO
             , E.NICKNAME
             , A.BOARD_COUNT
             , A.CREATED_DATE
             , A.BOARD_STATUS
          FROM (SELECT ROWNUM RNUM
                     , B.BOARD_NO
                     , B.BOARD_TYPE
                     , B.CATEGORY_CODE
                     , B.BOARD_TITLE
                     , B.BOARD_BODY
                     , B.BOARD_WRITER_MEMBER_NO
                     , B.BOARD_COUNT
                     , B.CREATED_DATE
                     , B.BOARD_STATUS
                  FROM (SELECT C.BOARD_NO
                             , C.BOARD_TYPE
                             , C.CATEGORY_CODE
                             , C.BOARD_TITLE
                             , C.BOARD_BODY
                             , C.BOARD_WRITER_MEMBER_NO
                             , C.BOARD_COUNT
                             , C.CREATED_DATE
                             , C.BOARD_STATUS
                          FROM TBL_BOARD C
                        <if test="searchCondition == 'category'">
	      				  JOIN TBL_CATEGORY D ON(C.CATEGORY_CODE = D.CATEGORY_CODE)
    					</if>
    					<if test="searchCondition == 'writer'">
	      				  JOIN TBL_MEMBER D ON(C.BOARD_WRITER_MEMBER_NO = D.MEMBER_NO)
    					</if>
    					<where>
							<if test="searchCondition == 'category'">
	           				   D.CATEGORY_NAME = #{ searchValue }
							</if>
							<if test="searchCondition == 'writer'">
	           				   D.NICKNAME LIKE '%' || #{ searchValue } || '%'	
							</if>
							<if test="searchCondition == 'title'">
	           				   C.BOARD_TITLE LIKE '%' || #{ searchValue } || '%' 	
							</if>
							<if test="searchCondition == 'content'">
	           				   C.BOARD_BODY LIKE '%' || #{ searchValue } || '%' 	
							</if>
	       				   AND C.BOARD_STATUS = 'Y'
    					</where>
                         ORDER BY C.BOARD_NO DESC
                        ) B
                  <![CDATA[
                  WHERE ROWNUM <= #{ endRow }
                  ]]>
               ) A
          JOIN TBL_CATEGORY D ON (A.CATEGORY_CODE = D.CATEGORY_CODE)
          JOIN TBL_MEMBER E ON(A.BOARD_WRITER_MEMBER_NO = E.MEMBER_NO)
         WHERE A.RNUM >= #{ startRow }     
         ORDER BY A.RNUM 
	</select>

	<insert id="insertProductContent" >
	        INSERT /* com.planty.jsp.product.model.dao.ProductDAO#insertProductContent() */
	          INTO PRODUCT 
	        (
	          PRO_NO
	        , CATE_NO
	        , ID	        
	        , PRO_NAME
	        , PRO_PRICE
	        , PRO_CONTENT
	        )
	        VALUES 
	        (
	          SEQ_PRO_NO.NEXTVAL
	        , #{ proNo }
	        , #{ cateNo }
	        , #{ id }
	        , #{ proName }
	        , #{ proPrice }
	        , #{ imgList }
	        )
	        <selectKey keyProperty="no" resultType="Integer" order="AFTER">
	        	SELECT
	        	       SEQ_PRO_NO.CURRVAL
	        	  FROM DUAL
	        </selectKey>
		</insert>

			
		
		<insert id="insertAttachment">
        INSERT /* com.planty.jsp.product.model.dao.ProductDAO#insertAttachment() */
          INTO PRO_IMG
        (
          IMG_NO
        , PRO_NO
        , P_PATH
        , FILE_NAME
        , SER_FILE
        , THUM_FILE
        )
        VALUES 
        (
          SEQ_ATTACHMENT_NO.NEXTVAL
        , #{ imgNo }
        , #{ proNo }
        , #{ proPath }
        , #{ fileName }
        , #{ serFile }
        , #{ thumFile }
        )
	</insert>
		
		
		
		
		
		
		
		
</mapper>
